<?xml version="1.0" encoding="utf-8" ?>
<ns0:cng_form xmlns:ns0="http://www.yesno.com.cn/mobile">
    <!--删除瓶码-->
    <CONTROL CONTROLTYPE="TEXTBOX" CTL_SHOWIDX="1" GROUP="NF1" HEIGHT="1" ID="BarCode">
        <NAME>数 码</NAME>
        <FIELDNAME>BarCode</FIELDNAME>
        <ALLOWINPUT>TRUE</ALLOWINPUT>
        <ALLOWSCAN>TRUE</ALLOWSCAN>
        <ISREADONLY>FALSE</ISREADONLY>
        <VALIDATE>
            <CONFIRM>KEY_ENTER</CONFIRM>
            <V VID="01" VTYPE="ISNOTNULL">
                <VVALUE>BarCode</VVALUE>
                <VFAIL MTYPE="INFO">数码不能为空！</VFAIL>
            </V>
            <V VID="02" VTYPE="DATABASE">
                <VVALUE>SELECT LENGTH(':BarCode') = 10 or LENGTH(':BarCode') = 20</VVALUE>
                <VFAIL MTYPE="ERROR">数码只能是10位或20位数字!</VFAIL>
            </V>
            <V VID="03" VTYPE="DATABASE">
                <VVALUE>
                    SELECT COUNT(1)>0 FROM T_PDM_CODE_SZ where F3 =':BarCode'
                </VVALUE>
                <VFAIL MTYPE="ERROR">该数码不存在，请扫描正确的数码！</VFAIL>
            </V>
        </VALIDATE>

        <V_OK>
            <ACTION ATYPE="SETDBPARAM">
                SELECT OPERATOR_NO as x_PRODUCT_CODE,F2 as X_BitchINFO from T_PDM_CODE_SZ where F3=':BarCode'
            </ACTION>
            <ACTION ATYPE="SETVALUE" TARGET="Old_BarCode">:BarCode</ACTION>
            <ACTION ATYPE="SETVALUE" TARGET="PROID">$x_PRODUCT_CODE</ACTION>
            <ACTION ATYPE="SETVALUE" TARGET="BitchINFO">$X_BitchINFO</ACTION>
            <ACTION ATYPE="DATASET" TARGET="BarCode">CLEAR</ACTION>
            <NEXTCONTROL>BarCode</NEXTCONTROL>
        </V_OK>
        <V_FALSE>
            <ACTION ATYPE="DATASET" TARGET="BarCode">CLEAR</ACTION>
            <NEXTCONTROL>BarCode</NEXTCONTROL>
        </V_FALSE>
    </CONTROL>

    <CONTROL CONTROLTYPE="TEXTBOX" CTL_SHOWIDX="2" GROUP="NF1" HEIGHT="1" ID="Old_BarCode">
        <NAME>待删数码</NAME>
        <FIELDNAME>Old_BarCode</FIELDNAME>
        <ALLOWINPUT>FALSE</ALLOWINPUT>
        <ALLOWSCAN>FALSE</ALLOWSCAN>
        <ISREADONLY>FALSE</ISREADONLY>
    </CONTROL>


    <CONTROL CONTROLTYPE="TEXTBOX" CTL_SHOWIDX="4" GROUP="NF1" HEIGHT="1" ID="PROID">
        <NAME>MID</NAME>
        <FIELDNAME>PROID</FIELDNAME>
        <ALLOWINPUT>FALSE</ALLOWINPUT>
        <ALLOWSCAN>FALSE</ALLOWSCAN>
        <ISREADONLY>FALSE</ISREADONLY>
        <INITDATA></INITDATA>
    </CONTROL>


    <CONTROL CONTROLTYPE="TEXTBOX" CTL_SHOWIDX="5" GROUP="NF1" HEIGHT="1" ID="BitchINFO">
        <NAME>批次ID</NAME>
        <FIELDNAME>BitchINFO</FIELDNAME>
        <ALLOWINPUT>FALSE</ALLOWINPUT>
        <ALLOWSCAN>FALSE</ALLOWSCAN>
        <ISREADONLY>FALSE</ISREADONLY>
        <INITDATA></INITDATA>

    </CONTROL>

    <!--确认删除-->
    <CONTROL CONTROLTYPE="BUTTON" CTL_SHOWIDX="11" GROUP="NF3" HEIGHT="1" ID="BTN_END">
        <NAME>确认删除</NAME>
        <VALIDATE>
            <CONFIRM>KEY_ENTER</CONFIRM>
            <V VID="01" VTYPE="ISNOTNULL">
                <VVALUE>Old_BarCode</VVALUE>
                <VFAIL MTYPE="ERROR">请扫描数码后再操作！</VFAIL>
            </V>
            <V VID="02" VTYPE="ISNULL">
                <VVALUE>Old_BarCode</VVALUE>
                <VFAIL MTYPE="QUESTION">确定要删除【:Old_BarCode】吗？</VFAIL>
            </V>
        </VALIDATE>
        <V_OK>
            <ACTION ATYPE="SAVEDATA">F5</ACTION>
            <ACTION ATYPE="MESSAGE" TARGET="INFO">删除成功！</ACTION>
            <ACTION ATYPE="DATASET" TARGET="BarCode">CLEAR</ACTION>
            <ACTION ATYPE="DATASET" TARGET="Old_BarCode">CLEAR</ACTION>
            <ACTION ATYPE="DATASET" TARGET="PROID">CLEAR</ACTION>
            <ACTION ATYPE="DATASET" TARGET="BitchINFO">CLEAR</ACTION>
            <NEXTCONTROL>BarCode</NEXTCONTROL>
        </V_OK>
        <V_FALSE>
            <ACTION ATYPE="DATASET" TARGET="BarCode">CLEAR</ACTION>
            <NEXTCONTROL>BarCode</NEXTCONTROL>
        </V_FALSE>
    </CONTROL>

    <CONTROL CONTROLTYPE="BUTTON" CTL_SHOWIDX="7" GROUP="NF0" HEIGHT="1" ID="BTN_CLOSE">
        <NAME>退出</NAME>
        <INITDATA>

        </INITDATA>
        <VALIDATE>
            <CONFIRM>KEY_ENTER</CONFIRM>
            <V VID="02" VTYPE="ISNULL">
                <VVALUE>Old_BarCode</VVALUE>
                <VFAIL MTYPE="QUESTION">确定要退出吗？</VFAIL>
            </V>
        </VALIDATE>
        <V_OK>
            <ACTION ATYPE="DATASET" TARGET="N003_1">CLOSE</ACTION>
        </V_OK>
        <V_FALSE>
            <NEXTCONTROL>BarCode</NEXTCONTROL>
        </V_FALSE>
    </CONTROL>

    <CONTROL CONTROLTYPE="FORM" CTL_SHOWIDX="0" GROUP="NF1" HEIGHT="1" ID="N003_1">
        <NAME>删除数码</NAME>
        <VALIDATE>
            <CONFIRM>LOAD</CONFIRM>
        </VALIDATE>
        <V_OK>

        </V_OK>
        <V_FALSE></V_FALSE>
    </CONTROL>

    <SAVEDATA>
        <FSAVE ID="F5">
            DELETE FROM T_PDM_CODE_SZ where F3=':Old_BarCode'
        </FSAVE>

    </SAVEDATA>

</ns0:cng_form>
