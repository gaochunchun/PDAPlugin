<?xml version="1.0" encoding="utf-8" ?>
<ns0:cng_form xmlns:ns0="http://www.yesno.com.cn/mobile">
    <!--发货查询统计-->
    <CONTROL CONTROLTYPE="TEXTBOX" CTL_SHOWIDX="3" GROUP="NF1" HEIGHT="1" ID="DOID">
        <NAME>出库单号</NAME>
        <FIELDNAME>DOID</FIELDNAME>
        <ALLOWINPUT>FALSE</ALLOWINPUT>
        <ALLOWSCAN>FALSE</ALLOWSCAN>
        <ISREADONLY>FALSE</ISREADONLY>
    </CONTROL>

    <CONTROL CONTROLTYPE="TEXTLONGBOX" CTL_SHOWIDX="3" GROUP="NF1" HEIGHT="1" ID="RECEIVE_UNIT">
        <NAME>收货单位</NAME>
        <FIELDNAME>RECEIVE_UNIT</FIELDNAME>
        <ALLOWINPUT>FALSE</ALLOWINPUT>
        <ALLOWSCAN>FALSE</ALLOWSCAN>
        <ISREADONLY>FALSE</ISREADONLY>
        <INITDATA></INITDATA>
    </CONTROL>

    <!--产品明细列表-->
    <CONTROL CONTROLTYPE="READONLYVIEW" CTL_SHOWIDX="7" GROUP="NF1" HEIGHT="6" ID="PRODUCT_LIST">
        <NAME>产品明细列表</NAME>
        <FIELDNAME>PRODUCT_LIST</FIELDNAME>
        <ALLOWINPUT>FALSE</ALLOWINPUT>
        <ALLOWSCAN>FALSE</ALLOWSCAN>
        <ISREADONLY>FALSE</ISREADONLY>
        <INITDATA>
            <ACTION ATYPE="UI" TARGET="PRODUCT_LIST">DISABLE</ACTION>
            <INIT IID="01" OTYPE="DATABASE">
                SELECT DISTINCT '' AS '产品名称',
                '' AS '计划',
                '' AS '已扫'
                From T_TEMP WHERE F1='T_TEMP'
            </INIT>
            <INIT IID="02" OTYPE="INIT_NOT_DATABASE">
                SELECT OUTPRO_NAME as '产品名称',
                CAST(F6 as int) || F4 as '计划',
                (SELECT CASE WHEN COUNT(1)>0 THEN SUM(C.F2)||'箱' ELSE '0箱' END FROM T_PDM_CHECKOUT C WHERE C.DoID ='$DOID' and C.OUTPRO_ZID
                =P.OUTPRO_CCNID) as '已扫' From T_PDM_SENDSTORE P WHERE DoID='$DOID'
                union all
                SELECT OUTPRO_NAME as '产品名称',
                '0' as '计划',
                CASE WHEN COUNT(1)>0 THEN SUM(S.F2) ELSE '0' END as '已扫'
                From T_PDM_CHECKOUT S WHERE DoID='$DOID' AND F8='1' GROUP BY OUTPRO_ZID
            </INIT>
        </INITDATA>
    </CONTROL>
    <CONTROL CONTROLTYPE="BUTTON" CTL_SHOWIDX="7" GROUP="NF0" HEIGHT="1" ID="BTN_CLOSE">
        <NAME>退出</NAME>
        <INITDATA>
            <!--判断本地存不存在该单据信息-->
            <ACTION ATYPE="SETDBPARAM">SELECT COUNT(0) as CNT FROM T_PDM_SENDSTORE WHERE DoID IS NOT NULL</ACTION>
            <CONDITION ID="01" VAL="NOT('$CNT'='0')">
                <ACTION ATYPE="SETDBPARAM">
                    SELECT RMF_NAME AS RMF_NAME,DoID AS DOID FROM T_PDM_SENDSTORE WHERE DoID IS NOT NULL LIMIT 1
                </ACTION>
                <ACTION ATYPE="SETVALUE" TARGET="DOID">$DOID</ACTION>
                <ACTION ATYPE="SETVALUE" TARGET="RECEIVE_UNIT">$RMF_NAME</ACTION>
                <ACTION ATYPE="DATASET" TARGET="PRODUCT_LIST">INIT</ACTION>
                <NEXTCONTROL>BTN_CLOSE</NEXTCONTROL>
                <ACTION ATYPE="GOTO" TARGET="END"></ACTION>
            </CONDITION>
            <CONDITION ID="02" VAL="'$CNT'='0'">
                <NEXTCONTROL>BTN_CLOSE</NEXTCONTROL>
                <ACTION ATYPE="GOTO" TARGET="END"></ACTION>
            </CONDITION>
        </INITDATA>
        <VALIDATE>
            <CONFIRM>KEY_ENTER</CONFIRM>
            <V VID="02" VTYPE="ISNULL">
                <VVALUE>DOID</VVALUE>
                <VFAIL MTYPE="QUESTION">确定要退出吗？</VFAIL>
            </V>
        </VALIDATE>
        <V_OK>
            <ACTION ATYPE="DATASET" TARGET="C005_QUr">CLOSE</ACTION>
        </V_OK>
        <V_FALSE></V_FALSE>
    </CONTROL>

    <CONTROL CONTROLTYPE="FORM" CTL_SHOWIDX="0" GROUP="NF1" HEIGHT="1" ID="C005_QUr">
        <NAME>查询统计</NAME>
        <VALIDATE>
            <CONFIRM>LOAD</CONFIRM>
            <V VID="01" VTYPE="DATABASE">
                <VVALUE>select COUNT(1)>0 FROM T_PDM_CHECKOUT WHERE DoID IS NOT NULL</VVALUE>
                <VFAIL MTYPE="INFO">还没有扫描数据，请扫描后再操作！</VFAIL>
            </V>
        </VALIDATE>
        <V_OK></V_OK>
        <V_FALSE>
            <ACTION ATYPE="DATASET" TARGET="C005_QUr">CLOSE</ACTION>
        </V_FALSE>
    </CONTROL>

    <SAVEDATA></SAVEDATA>

</ns0:cng_form>
